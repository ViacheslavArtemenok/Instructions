
# Работа с SSH

![Логотип ssh][Изображение_логотипа]


# 1. Установка ПО на целевой сервер

### Полезные видео:

[Как скопировать публичный ключ на удаленный сервер]

[Настраиваем аутентификацию SSH по ключу в Linux / Unix]

### Полезные статьи:

[Памятка пользователям ssh]
#

### В ssh-подключении участвуют две стороны:

1) Терминал сервера (например WSL, либо Linux Ubuntu на VirtualBox)
2) Терминал клиента (например терминал PowerShell на Windows 10)

# 
## Важно!!! 

### В нашем примере тестовые данные:

### ``* Корневая директория: /home/user``
### ``* IP-адрес сервера: 175.19.29.210``
### ``* Обращать внимание при копировании команд``
#

### В терминале на стороне ``сервера`` (терминал Linux)

Перед установкой всегда выполняем:
```
sudo apt update
```
После вызываем в терминале команду:

```
sudo systemctl enable ssh
sudo systemctl start ssh
sudo systemctl status ssh
```
Система предложит ввести пароль 

После получаем информацию о запущенном сервисе: 

``` Active: active (running) since Sun 2023-07-30 20:26:04 MSK; 13s ago...```

При необходимости можно выполнить:
```
sudo systemctl restart ssh
```
Сервис перезапуститься и будет активным

# 2. Аутентификация по паролю

### В терминале на стороне ``сервера`` (терминал Linux)

Для начала откроем файл ``sshd_config`` в редакторе vim или nano:
 ```
sudo nano /etc/ssh/sshd_config
```
В тексте файла находим строку PasswordAuthentication:
```
# Don't read the user's ~/.rhosts and ~/.shosts files
# IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!

PasswordAuthentication yes

# PermitEmptyPasswords no
```
Должно быть 

```PasswordAuthentication yes```

Если ``no``, меняем на ``yes`` и сохраняем

## Подключение ssh по паролю
### В терминале на стороне ``сервера`` (терминал Linux)
В терминале вводим команду:
```
ip addr
```
Находим строку вида: 

inet ``175.19.29.210``/20 brd 175.19.32.255 scope global eth0

или
```
hostname -I
```
Получаем: ```175.19.29.210```

Это ip-адрес сервера, он нам нужен для подключения

Команда 
```
whoami
```
Ответ - имя пользователя (например ```user```)

### В терминале на стороне ``клиента`` (терминал Windows)

В терминале вводим команду:
```
ssh user@175.19.29.210
```
Вводим пароль пользователя
```
[sudo] password for user: _
```

```user@MSI:~$ _```

Успех! Вы получили доступ к терминалу удаленного сервера.

# 3. Аутентификация по ключу
У нас уже настроено подключение по паролю, теперь можно настроить подключение по ключу

### В терминале на стороне ``клиента`` (терминал Windows)
* Если вы ранее не генерировали ключи для сервера и клиента, выполняем команду:

```
ssh-keygen
```
и наживаем несколько раз Enter для установки по умолчанию

В папке ``C:\Users\yourName\.ssh`` появятся файлы:

``id_rsa``

``id_rsa.pub``

* Если у вас уже есть ключи в папке ``C:\Users\yourName\.ssh``, пропускаем этот шаг

* Теперь нам необходимо скопировать публичный ключ на сторону сервера

Создаем папку .ssh
```
ssh user@175.19.29.210 mkdir /home/user/.ssh/
```
``user@175.19.29.210's password: _``

и вводим пароль

* Чтобы скопировать публичный ключ на сервер, выполняем:
```
scp C:\Users\yourName\.ssh\id_rsa.pub user@175.19.29.210:/home/user/.ssh/authorized_keys
```
``user@175.19.29.210's password: _``

и вводим пароль

Здесь мы копируем файл ``id_rsa.pub`` из папки .ssh клиента ``C:\Users\yourName\.ssh`` и вставляем в папку на сервере ``/home/user/.ssh`` под названием ``authorized_keys``

### В терминале на стороне ``сервера`` (терминал Linux)

* Открываем файл ``sshd_config`` в редакторе vim или nano:
 ```
sudo nano /etc/ssh/sshd_config
```
В тексте файла находим строку PasswordAuthentication

Меняем на ```PasswordAuthentication no``` и сохраняем

Перезапускаем службу ssh:
```
sudo systemctl restart ssh
```

Успех! Теперь ssh-подключение происходит по ключу


[Изображение_логотипа]: img/ssh_logo.png

[ссылка на GitHub]: https://github.com
[Как скопировать публичный ключ на удаленный сервер]: https://www.youtube.com/watch?v=gce7niSU82E

[Настраиваем аутентификацию SSH по ключу в Linux / Unix]: https://www.youtube.com/watch?v=IVHv3eVQa14&t=2s

[Памятка пользователям ssh]: https://habr.com/ru/articles/122445/